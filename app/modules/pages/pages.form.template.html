<div class="page-title">
    <div class="row flex-center">
        <div class="col-md-6">
            <div class="title-env">
                <h1 class="title">{{ title }}</h1>
            </div>
        </div>
        <div class="col-md-6">
            <div class="breadcrumb-env">
                <ol class="breadcrumb bc-1">
                    <li>
                        <a href="#/">
                            <i class="fa-home"></i>Home
                        </a>
                    </li>
                    <li>
                        <a href="#/page">
                            <strong>Páginas</strong>
                        </a>
                    </li>
                    <li class="active">
                        <a href="#/page">
                            <strong>{{ title }}</strong>
                        </a>
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>
<div class="row" can-get>
    <div class="col-xs-8 panel panel-default">
        <form class="form" name="formData" novalidate>
            <div class="row">
                <div class="col-xs-12">
                    <div class="form-group" ng-class="{'has-error': formData.title.$error.required && !formData.title.$valid}">
                        <label for="title">Título</label>
                        <input id="title" type="text" name="title" class="form-control" ng-model="page.title" required>
                        <div ng-show="!formData.title.$valid" class="error-message" role="alert">
                            <div ng-show="formData.title.$error.required">Campo obrigatório</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="form-group">
                        <label for="title">Slug</label>
                        <input id="title" type="text" name="slug" class="form-control" ng-model="page.slug.slug">
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-8">
                    <div class="form-group">
                        <label>Tags</label>
                        <tags-input add-on-comma="false" ng-model="page.tags">
                            <auto-complete source="findTags($query)" max-results-to-show="1000" minLength="1"></auto-complete>
                        </tags-input>
                    </div>
                </div>
                <div class="col-xs-4">
                    <div class="form-group">
                        <label>Template</label>
                        <select title="Template" class="form-control" ng-model="page.columns" ng-options="column.value as column.label for column in columns"></select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-12"></div>
            </div>
            <div class="row">
                <div class="col-xs-12">
                    <div class="pages-module add-module pages-module-cover" ng-show="!viewOnly">
                        <div class="chosen-cover">
                            <a href="javascript:void(0);" class="label label-danger remove-image" ng-click="removeImage()" ng-show="page.image">
                                    <i class="fa fa-remove"></i> REMOVER IMAGEM
                                </a>
                        </div>
                        <div class="add-title" ng-model="page_cover" ng-click="uploadCover()" ng-show=!page.image>+ Adicionar Capa
                        </div>
                        <div class="uploaded-image" ng-show="page.image">
                            <img class="img-responsive" ng-src="{{ page.image.url }}">
                        </div>
                    </div>
                    <div class="pages-module add-module pages-module-cover" ng-show="viewOnly && page.image.url">
                        <div class="uploaded-image" ng-show="page.image">
                            <img class="img-responsive" ng-src="{{ page.image.url }}">
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div id="sort-main" as-sortable="sortableOptions" ng-model="page.widgets.main" ng-class="{ 'col-xs-8': page.columns == 2, 'col-xs-12': page.columns == 1 }">
                    <div class="pages-module" ng-repeat="item in page.widgets.main" as-sortable-item>
                        <div class="row flex-center">
                            <div class="col-md-10">
                                <h4>
                                    <strong>{{ item.title }}</strong>
                                </h4>
                                <h5 class="text-capitalize">{{ item.type|translate }}</h5>
                            </div>
                            <div class="col-md-2" ng-if="!viewOnly">
                                <span class="label label-warning" ng-click="handleModule('main', $index)">
                                    <i class="fa fa-pencil"></i> EDITAR
                                </span>
                                <span class="label label-danger" ng-click="removeModuleMain($index)">
                                    <i class="fa fa-remove"></i> REMOVER
                                </span>
                                <span class="label label-primary" as-sortable-item-handle>
                                    <i class="fa fa-arrows-v"></i> MOVER
                                </span>
                            </div>
                        </div>
                    </div>
                    <div ng-if="!viewOnly" class="pages-module add-module" ng-click="handleModule('main')">
                        <span class="add-title">+ Adicionar Módulo</span>
                    </div>
                </div>
                <div id="sort-side" as-sortable="sortableOptions" ng-model="page.widgets.side" ng-class="{ 'col-xs-4': page.columns === 2, 'hidden': page.columns === 1 }">
                    <div class="pages-module" ng-repeat="item in page.widgets.side" as-sortable-item>
                        <div class="row flex-center">
                            <div class="col-md-8">
                                <h4>
                                    {{ item.title }}
                                </h4>
                                <h5 class="text-capitalize">{{ item.type|translate }}</h5>
                            </div>
                            <div class="col-md-4" ng-if="!viewOnly">
                                <span class="label label-warning" ng-click="handleModule('side', $index)">
                                    <i class="fa fa-pencil"></i> EDITAR
                                </span>
                                <span class="label label-danger" ng-click="removeModuleSide($index)">
                                    <i class="fa fa-remove"></i> REMOVER
                                </span>
                                <span class="label label-primary" as-sortable-item-handle>
                                    <i class="fa fa-arrows-v"></i> MOVER
                                </span>
                            </div>
                        </div>
                    </div>
                    <div ng-if="!viewOnly" class="pages-module add-module" ng-click="handleModule('side')">
                        <span class="add-title">+ Adicionar Módulo</span>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="col-xs-4">
        <publishment-options route-model="page"></publishment-options>
        <div class="panel panel-default" onload="loadMorePage()">
            A página atual é filha de:
            <ui-select ng-model="page.parent" theme="bootstrap" class="ui-select" title="Selecione ou procure a página...">
                <ui-select-match placeholder="Selecione ou procure a página...">{{ $select.selected.title }}</ui-select-match>
                <ui-select-choices repeat="item.id as item in pagesParent | filter: $select.search track by $index" scroll-detect="loadMorePage()"
                    refresh="loadMorePage($select.search)" refresh-delay="300">
                    <div ng-bind-html="item.title | highlight: $select.search"></div>
                </ui-select-choices>
            </ui-select>
        </div>
        <div class="panel panel-default" ng-if="User.is_administrator">
            Tipo da página:
            <ui-select ng-model="page.page_type" theme="bootstrap" class="ui-select" title="Selecione ou procure a página...">
                <ui-select-match placeholder="Selecione ou procure a página...">{{ $select.selected.name }}</ui-select-match>
                <ui-select-choices repeat="type.id as type in typesData.items | filter: $select.search track by $index">
                    <div ng-bind-html="type.name | highlight: $select.search"></div>
                </ui-select-choices>
            </ui-select>

        </div>
    </div>
</div>
<ng-include src="'components/widget/partials/redactor-templates.html'"></ng-include>
